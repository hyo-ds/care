import streamlit as st
import pandas as pd
import datetime
import os
import sqlite3

# 📁 파일경로 설정
CSV_PATH = "경북_공고_설문결과.csv"
DB_PATH = "gb_data.db"

# ✅ 최초 실행시 DB 및 테이블 자동 생성
def initialize_database():
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute('''
    CREATE TABLE IF NOT EXISTS survey (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        응답일시 TEXT,
        응답자부서 TEXT,
        응답자연락처 TEXT,
        기관 TEXT,
        사업명 TEXT,
        카테고리 TEXT,
        주제 TEXT,
        가구 TEXT,
        나이 TEXT,
        정부24등록 TEXT,
        접수기관명 TEXT,
        지원대상 TEXT,
        지원내용 TEXT,
        신청방법 TEXT,
        문의처 TEXT,
        온라인URL TEXT
    )
    ''')
    conn.commit()
    conn.close()

# ✅ SQLite 저장 함수
def save_to_database(data):
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute('''
    INSERT INTO survey (응답일시, 응답자부서, 응답자연락처, 기관, 사업명, 카테고리, 주제, 가구, 나이, 정부24등록, 접수기관명, 지원대상, 지원내용, 신청방법, 문의처, 온라인URL)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    ''', (
        data['응답일시'], data['응답자부서'], data['응답자연락처'], data['기관'], data['사업명'], 
        data['카테고리'], data['주제'], data['가구'], data['나이'], data['정부24등록'],
        data['접수기관명'], data['지원대상'], data['지원내용'], data['신청방법'], data['문의처'], data['온라인URL']
    ))
    conn.commit()
    conn.close()

# ✅ CSV 저장 함수
def save_to_csv(data):
    file_exists = os.path.isfile(CSV_PATH)
    df_new = pd.DataFrame([data])
    if file_exists:
        df_existing = pd.read_csv(CSV_PATH)
        df_combined = pd.concat([df_existing, df_new], ignore_index=True)
    else:
        df_combined = df_new
    df_combined.to_csv(CSV_PATH, index=False, encoding='utf-8-sig')

# ✅ SQLite 중복 검사 함수
def check_duplicate(data):
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    query = '''
    SELECT COUNT(*) FROM survey
    WHERE 기관 = ? AND 사업명 = ? AND 지원대상 = ? AND 지원내용 = ? AND 신청방법 = ?
    '''
    c.execute(query, (
        data['기관'], data['사업명'], data['지원대상'], data['지원내용'], data['신청방법']
    ))
    count = c.fetchone()[0]
    conn.close()
    return count > 0

# ✅ 통합 저장 함수 (CSV + SQLite)
def save_data(data):
    save_to_database(data)
    save_to_csv(data)

# DB 최초 초기화
initialize_database()

# 🎯 실전 설문 시작 ---------------------------------------------------



# 기관 리스트

# 기관 리스트
부서_리스트 = [
    'AI데이터과',
    '저출생대응정책과',
    '공공의료과',
    '구조구급과',
    '교통정책과',
    '해양레저관광과',
    '보건정책과',
    '스마트농업혁신과',
    '경북도서관',
    '관광마케팅과',
    '외국인공동체과',
    '아이돌봄과',
    '자치경찰정책과',
    '재난대응과',
    '새마을봉사과',
    '농식품유통과',
    '예방안전과',
    '문화예술과',
    '교육청소년과',
    '119종합상황실',
    '농업대전환과',
    '농업테크노파크과',
    '청년정책과',
    '건축디자인과',
    '지역개발과',
    '도시계획과',
    '공항추진과',
    '수자원관리과',
    '여성가족과',
    '경제정책노동과',
    '축산정책과',
    '민생경제과',
    '기업지원과',
    '문화산업과',
    '지방시대정책과',
    '인재개발원 교육운영과'
]


사업리스트 = {
    'AI데이터과': [
        '돌봄 통합정보 제공 서비스',
        '제조업 A융합 기반 조성사업'
    ],
    '저출생대응정책과': [
        '결혼 축하 혼수 비용 지원',
        '청춘남녀 만남주선 사업 지원',
        '(남성) 난임부부 시술비 지원',
        '한의약 난임치료지원',
        '영구적불임예상생식세포동결보존지원',
        '냉동난자 사용 보조생식술 지원',
        '임신사전 건강관리지원',
        '안동의료원난임센터운영지원',
        '난임·우울증 상담센터 운영지원',
        '35세이상산모의료비지원',
        '청소년산모의료비지원',
        '고위험임산부의료비지원',
        '거점형 공공산후조리원 설치지원',
        '공공산후조리원 확대',
        '공공산후조리원 운영지원',
        '경북형 신생아 집중치료센터 운영 지원',
        '산모 신생아 건강관리지원',
        '생애초기 건강관리 지원',
        '출산축하박스지원',
        '미숙아 및 선천성 이상아 의료비 지원',
        '선천성 대사이상 검사 및 환아 관리',
        '난청조기진단',
        '저소득층 기저귀 조제분유 지원',
        '출산 및 보육 관련 프로그램 지원',
        '첫만남이용권 지원',
        '융합 돌봄 특구 조성',
        '산단 특화 돌봄‧교육 통합센터 건립',
        '다자녀 가정 큰 집 마련 지원',
        '세자녀 이상 가족진료비 지원',
        '다자녀 가정 농수산물 구입 지원',
        '다자녀 가구 이사비 지원',
        '지자체선도 저출생 대응 인식개선 사업(100인의 아빠단)',
        '인구의날기념행사',
        '아이사랑가족대축제',
        '다자녀 가정 권리장전 제정',
        '다둥이 가족 대잔치',
        '저출생극복세미나및포럼개최등',
        '저출생극복우수시군포상',
        '저출생극복범도민공감대확산',
        '출산장려콘텐츠공모전',
        '저출생극복연구용역',
        '저출생극복박람회개최등',
        '저출생대응정책홍보캠페인',
        '저출생정책평가센터운영',
        '저출생극복워킹그룹운영등'
    ],
    '공공의료과': [
        '산부인과‧소아과 One-hour 진료체계 구축(민간)',
        '산부인과소아과 One-hour 진료체계구축(자치단체)',
        '김천의료원 분만산부인과 운영'
    ],
    '구조구급과': [
        '새생명탄생119구급서비스'
    ],
    '교통정책과': [
        '임산부 전용 콜택시 운영 지원',
        '온종일 자녀안심 아이사랑 차량 운행'
    ],
    '해양레저관광과': [
        '임신부 어촌마을 태교여행 지원',
        '청년 유입을 위한 빈집 활용 어촌재생 프로젝트'
    ],
    '보건정책과': [
        '순회진료산부인과운영',
        '찾아가는산부인과운영',
        '찾아가는산부인과진료버스구입',
        '분만취약지산부인과운영',
        '분만취약지외래산부인과운영',
        '어린이 식생활영양안전관리 지원',
        '늘봄학교 급‧간식 업체 정보 제공',
        '함께 키워요! 「K보듬 6000」급‧간식 업체 정보지원'
    ],
    '스마트농업혁신과': [
        '임산부 친환경 농산물 지원'
    ],
    '경북도서관': [
        '초보 엄마아빠 북돋움 책선물 사업',
        '돌봄‧독서 융합「경상북도 돌봄도서관」운영',
        '함께 키우는 작은도서관 돌봄사업'
    ],
    '관광마케팅과': [
        '예비 엄마아빠를 위한 행복가족여행',
        '가족이 행복한 축제한마당'
    ],
    '외국인공동체과': [
        '열린 맘 임신 출산 서비스 지원',
        '다문화가족자녀학습및진로지원',
        '다문화가족자녀이중언어대회',
        '다문화인재세계화추진',
        '다문화가족자녀글로벌인재육성지원',
        '외국인 영유아 자녀 보육료 지원',
        '결혼이민여성일자리창출사업',
        '유입부터 정주까지 책임, 아시아 이주 허브'
    ],
    '아이돌봄과': [
        '부모급여',
        '가정양육수당 지원',
        'K보듬지원센터운영',
        '어린이 보듬밥상',
        '찾아가는 놀이 돌봄',
        '장난감도서관 설치 및 운영',
        '영유아창의센터운영',
        '조부모 손자녀 돌봄사업',
        '아이돌봄지원사업 광역지원센터운영지원',
        '영아전담아이돌보미지원',
        '아이돌봄 종사자 처우개선비(수당) 지원',
        '틈새 돌봄을 위한「대학생 아이돌봄 서포터즈」운영',
        '아이돌봄 지원',
        '아이돌봄 부모부담금 경감',
        '함께 키워요! 「K보듬 6000」프로젝트',
        '아픈아이 긴급 돌봄센터 운영',
        '24시 시간제 보육 지원',
        '마을돌봄터(다함께돌봄센터) 설치‧운영',
        '공동육아나눔터운영',
        '도‧시군 육아종합지원센터 운영',
        '공공형 어린이집 지원',
        '아빠와 함께하는 아이행복 캠페인',
        '영유아 대축제'
    ],
    '자치경찰정책과': [
        '함께 키워요! 「K보듬 6000」이동․안전 지원(자치경찰)',
        '늘봄학교 등하교 안전인력 지원(자치경찰)'
    ],
    '재난대응과': [
        '함께 키워요! 「K보듬 6000」이동․안전 지원(소방본부)'
    ],
    '새마을봉사과': [
        '함께 키워요! 「K보듬 6000」자원봉사 프로그램',
        '함께 키워요! 「K보듬 6000」자원봉사 스케일업',
        '늘봄학교 자원봉사자 지원'
    ],
    '농식품유통과': [
        '함께 키워요! 「K보듬 6000」친환경 과일간식 지원'
    ],
    '예방안전과': [
        '119아이행복 돌봄터 운영'
    ],
    '문화예술과': [
        '종교시설을 활용한 돌봄공동체 지원',
        '문화로 행복한 K-다둥이 프로젝트',
        '전통시장 어린이 체험시설 설치'
    ],
    '교육청소년과': [
        '아동수당',
        '늘봄학교 지원',
        '늘봄학교 분야별 전문가 현황 제공',
        '제21회 대한민국 청소년 박람회 개최',
        '청소년 지원 정책',
        '도 청소년 활동진흥센터 지원',
        '시군 청소년 수련시설 확충',
        '청소년 정책참여 및 권익증진',
        '청소년 제안정책 실현사업',
        '도 청소년수련원 기능보강',
        '아동친화도시 조성 지원사업'
    ],
    
    '119종합상황실': [
        '늘봄학교 안전 지원(소방본부)'
    ],
    '농업대전환과': [
        '농촌형 보육서비스 지원사업',
        '농어촌지역 사랑의 공부방 운영 지원',
        '여성농업인 복지시설 운영 지원',
        '출산농가영농도우미 지원'
    ],
    '농업테크노파크과': [
        '농촌가정 출생육아 멘토링'
    ],
    '청년정책과': [
        '청년 월세 한시 특별 지원',
        '청년부부 주거환경 개선'
    ],
    '건축디자인과': [
        '청년 신혼부부 월세 지원',
        '신혼부부 임차보증금 이자지원사업',
        '양육친화형 공공임대주택 공급 추진',
        '지역밀착형 공공임대주택 공급 확대'
    ],
    '지역개발과': [
        '청년 유입을 위한 지역활력타운 조성',
        '도시재생을 통한 공공임대주택 확대'
    ],
    '도시계획과': [
        '도시개발사업구역과 연계한 양육‧친화공간 조성',
        '개발제한구역 활용 주거안정성 확보'
    ],
    '공항추진과': [
        '공항신도시 아이사랑 리빙파크 조성'
    ],
    '수자원관리과': [
        '청년을 위한 하천부지활용 택지공급'
    ],
    '여성가족과': [
        '일‧생활 균형 지원센터 운영',
        '경북 여성일자리 취창업 매칭데이',
        '돌봄연계 경상북도 일자리 편의점 구축',
        '초등맘 10시 출근제 도입 중소기업 장려금 지원',
        '경북형 여성친화도시 조성사업',
        '양성평등정책지원사업',
        '여성리더양성 및 네트워크 사업',
        '우리동네 아빠 교실 운영',
        '청소년부모 양육 등 통합 패키지 지원'
    ],
    '경제정책노동과': [
        '육아휴직 대체인력 근로자 인센티브 지원',
        '육아기 부모 단축 근로시간 급여 보전 지원'
    ],
    '축산정책과': [
        '다자녀축산농가헬퍼(도우미)지원'
    ],
    '민생경제과': [
        '소상공인 출산장려 「아이보듬」지원',
        '전통시장 어린이 체험시설 설치'
    ],
    '기업지원과': [
        '「육아기 근로 시간 단축제도 시행」중소기업 우대'
    ],
    '문화산업과': [
        '문화를 통한 민관협력형 저출생 극복 프로젝트'
    ],
    '지방시대정책과': [
        'K-U시티 청년정주 공동주택 보급'
    ],
    '인재개발원 교육운영과': [
        '신규공무원『저출생 극복 대응 프로그램』추진',
        '자녀돌봄&육아교실_실시간 온라인교육'
    ]
}

for 기관 in 부서_리스트:
    if 기관 not in 사업리스트:
        사업리스트[기관] = []


# 카테고리
전체_카테고리 = ['만남주선','행복출산','완전돌봄','안심주거','일생활균형','양성평등']
사업별_카테고리 = {
    '돌봄 통합정보 제공 서비스': ['완전돌봄'],
    '제조업 A융합 기반 조성사업': ['일생활균형'],
    '결혼 축하 혼수 비용 지원': ['만남주선'],
    '청춘남녀 만남주선 사업 지원': ['만남주선'],
    '산부인과‧소아과 One-hour 진료체계 구축(민간)': ['행복출산'],
    '산부인과소아과 One-hour 진료체계구축(자치단체)': ['행복출산'],
    '(남성) 난임부부 시술비 지원': ['행복출산'],
    '한의약 난임치료지원': ['행복출산'],
    '영구적불임예상생식세포동결보존지원': ['행복출산'],
    '냉동난자 사용 보조생식술 지원': ['행복출산'],
    '임신사전 건강관리지원': ['행복출산'],
    '안동의료원난임센터운영지원': ['행복출산'],
    '난임·우울증 상담센터 운영지원': ['행복출산'],
    '35세이상산모의료비지원': ['행복출산'],
    '청소년산모의료비지원': ['행복출산'],
    '고위험임산부의료비지원': ['행복출산'],
    '새생명탄생119구급서비스': ['행복출산'],
    '임산부 전용 콜택시 운영 지원': ['행복출산'],
    '임신부 어촌마을 태교여행 지원': ['행복출산'],
    '김천의료원 분만산부인과 운영': ['행복출산'],
    '순회진료산부인과운영': ['행복출산'],
    '찾아가는산부인과운영': ['행복출산'],
    '찾아가는산부인과진료버스구입': ['행복출산'],
    '분만취약지산부인과운영': ['행복출산'],
    '분만취약지외래산부인과운영': ['행복출산'],
    '거점형 공공산후조리원 설치지원': ['행복출산'],
    '공공산후조리원 확대': ['행복출산'],
    '공공산후조리원 운영지원': ['행복출산'],
    '경북형 신생아 집중치료센터 운영 지원': ['행복출산'],
    '산모 신생아 건강관리지원': ['행복출산'],
    '생애초기 건강관리 지원': ['행복출산'],
    '출산축하박스지원': ['행복출산'],
    '산모 건강회복 동해 특산 미역 지원': ['행복출산'],
    '임산부 친환경 농산물 지원': ['행복출산'],
    '초보 엄마아빠 북돋움 책선물 사업': ['행복출산'],
    '예비 엄마아빠를 위한 행복가족여행': ['행복출산'],
    '열린 맘 임신 출산 서비스 지원': ['행복출산'],
    '미숙아 및 선천성 이상아 의료비 지원': ['행복출산'],
    '선천성 대사이상 검사 및 환아 관리': ['행복출산'],
    '난청조기진단': ['행복출산'],
    '저소득층 기저귀 조제분유 지원': ['행복출산'],
    '출산 및 보육 관련 프로그램 지원': ['행복출산'],
    '첫만남이용권 지원': ['행복출산'],
    '부모급여': ['행복출산'],
    '가정양육수당 지원': ['행복출산'],
    '아동수당': ['행복출산'],
    'K보듬지원센터운영': ['완전돌봄'],
    '어린이 보듬밥상': ['완전돌봄'],
    '어린이 식생활영양안전관리 지원': ['완전돌봄'],
    '영아 표준 보육 과정 신설': ['완전돌봄'],
    '찾아가는 놀이 돌봄': ['완전돌봄'],
    '장난감도서관 설치 및 운영': ['완전돌봄'],
    '휴양림 키즈카페 조성사업': ['완전돌봄'],
    '모두의 놀이터 조성': ['완전돌봄'],
    '영유아창의센터운영': ['완전돌봄'],
    '조부모 손자녀 돌봄사업': ['완전돌봄'],
    '아이돌봄지원사업 광역지원센터운영지원': ['완전돌봄'],
    '영아전담아이돌보미지원': ['완전돌봄'],
    '아이돌봄 종사자 처우개선비(수당) 지원': ['완전돌봄'],
    '틈새 돌봄을 위한「대학생 아이돌봄 서포터즈」운영': ['완전돌봄'],
    '아이돌봄 지원': ['완전돌봄'],
    '아이돌봄 부모부담금 경감': ['완전돌봄'],
    '함께 키워요! 「K보듬 6000」프로젝트': ['완전돌봄'],
    '함께 키워요! 「K보듬 6000」이동․안전 지원(자치경찰)': ['완전돌봄'],
    '함께 키워요! 「K보듬 6000」이동․안전 지원(소방본부)': ['완전돌봄'],
    '함께 키워요! 「K보듬 6000」자원봉사 프로그램': ['완전돌봄'],
    '함께 키워요! 「K보듬 6000」자원봉사 스케일업': ['완전돌봄'],
    '함께 키워요! 「K보듬 6000」친환경 과일간식 지원': ['완전돌봄'],
    '함께 키워요! 「K보듬 6000」급‧간식 업체 정보지원': ['완전돌봄'],
    '아픈아이 긴급 돌봄센터 운영': ['완전돌봄'],
    '24시 시간제 보육 지원': ['완전돌봄'],
    '119아이행복 돌봄터 운영': ['완전돌봄'],
    '종교시설을 활용한 돌봄공동체 지원': ['완전돌봄'],
    '늘봄학교 지원': ['완전돌봄'],
    '늘봄학교 안전 지원(소방본부)': ['완전돌봄'],
    '늘봄학교 등하교 안전인력 지원(자치경찰)': ['완전돌봄'],
    '늘봄학교 자원봉사자 지원': ['완전돌봄'],
    '늘봄학교 분야별 전문가 현황 제공': ['완전돌봄'],
    '늘봄학교 급‧간식 업체 정보 제공': ['완전돌봄'],
    '농촌형 보육서비스 지원사업': ['완전돌봄'],
    '농어촌지역 사랑의 공부방 운영 지원': ['완전돌봄'],
    '농촌가정 출생육아 멘토링': ['완전돌봄'],
    '온종일 자녀안심 아이사랑 차량 운행': ['완전돌봄'],
    '지역 예술인과 함께하는 아이돌봄 예술교육': ['완전돌봄'],
    '가족친화형 우수캠핑장 지원': ['완전돌봄'],
    '돌봄‧독서 융합「경상북도 돌봄도서관」운영': ['완전돌봄'],
    '함께 키우는 작은도서관 돌봄사업': ['완전돌봄'],
    '다문화가족자녀학습및진로지원': ['완전돌봄'],
    '다문화가족자녀이중언어대회': ['완전돌봄'],
    '다문화인재세계화추진': ['완전돌봄'],
    '다문화가족자녀글로벌인재육성지원': ['완전돌봄'],
    '외국인 영유아 자녀 보육료 지원': ['완전돌봄'],
    '청소년부모 양육 등 통합 패키지 지원': ['완전돌봄'],
    '입양아동 및 위기임산부 보호지원 체계 구축': ['완전돌봄'],
    '마을돌봄터(다함께돌봄센터) 설치‧운영': ['완전돌봄'],
    '공동육아나눔터운영': ['완전돌봄'],
    '지역아동센터 특성화사업 지원': ['완전돌봄'],
    '도‧시군 육아종합지원센터 운영': ['완전돌봄'],
    '공공형 어린이집 지원': ['완전돌봄'],
    '제21회 대한민국 청소년 박람회 개최': ['완전돌봄'],
    '청소년 지원 정책': ['완전돌봄'],
    '도 청소년 활동진흥센터 지원': ['완전돌봄'],
    '시군 청소년 수련시설 확충': ['완전돌봄'],
    '청소년 정책참여 및 권익증진': ['완전돌봄'],
    '청소년 제안정책 실현사업': ['완전돌봄'],
    '도 청소년수련원 기능보강': ['완전돌봄'],
    '융합 돌봄 특구 조성': ['완전돌봄'],
    '산단 특화 돌봄‧교육 통합센터 건립': ['완전돌봄'],
    '공항신도시 아이사랑 리빙파크 조성': ['완전돌봄'],
    '도시개발사업구역과 연계한 양육‧친화공간 조성': ['안심주거'],
    '어린이집 안전공제회비 지원': ['안심주거'],
    '안심하고 학교 가는 길 조성': ['안심주거'],
    '청년 신혼부부 월세 지원': ['안심주거'],
    '청년 월세 한시 특별 지원': ['안심주거'],
    '신혼부부 임차보증금 이자지원사업': ['안심주거'],
    '청년부부 주거환경 개선': ['안심주거'],
    '다자녀 가정 큰 집 마련 지원': ['안심주거'],
    '양육친화형 공공임대주택 공급 추진': ['안심주거'],
    '지역밀착형 공공임대주택 공급 확대': ['안심주거'],
    '문화를 통한 민관협력형 저출생 극복 프로젝트': ['안심주거'],
    'K-U시티 청년정주 공동주택 보급': ['안심주거'],
    '청년 유입을 위한 빈집 활용 어촌재생 프로젝트': ['안심주거'],
    '마린보이 청년어부 어촌정착 패키지 지원': ['안심주거'],
    '청년 유입을 위한 지역활력타운 조성': ['안심주거'],
    '도시재생을 통한 공공임대주택 확대': ['안심주거'],
    '개발제한구역 활용 주거안정성 확보': ['안심주거'],
    '청년을 위한 하천부지활용 택지공급': ['안심주거'],
    '일‧생활 균형 지원센터 운영': ['일생활균형'],
    '육아휴직 대체인력 근로자 인센티브 지원': ['일생활균형'],
    '여성농업인 복지시설 운영 지원': ['일생활균형'],
    '다자녀축산농가헬퍼(도우미)지원': ['일생활균형'],
    '경북 여성일자리 취창업 매칭데이': ['일생활균형'],
    '결혼이민여성일자리창출사업': ['일생활균형'],
    '돌봄연계 경상북도 일자리 편의점 구축': ['일생활균형'],
    '육아기 부모 단축 근로시간 급여 보전 지원': ['일생활균형'],
    '소상공인 출산장려 「아이보듬」지원': ['일생활균형'],
    '초등맘 10시 출근제 도입 중소기업 장려금 지원': ['일생활균형'],
    '「육아기 근로 시간 단축제도 시행」중소기업 우대': ['일생활균형'],
    '출산농가영농도우미 지원': ['일생활균형'],
    '경북형 여성친화도시 조성사업': ['양성평등'],
    '아동친화도시 조성 지원사업': ['양성평등'],
    '양성평등정책지원사업': ['양성평등'],
    '여성리더양성 및 네트워크 사업': ['양성평등'],
    '우리동네 아빠 교실 운영': ['양성평등'],
    '지자체선도 저출생 대응 인식개선 사업(100인의 아빠단)': ['양성평등'],
    '아빠와 함께하는 아이행복 캠페인': ['양성평등'],
    '영유아 대축제': ['양성평등'],
    '인구의날기념행사': ['양성평등'],
    '아이사랑가족대축제': ['양성평등'],
    '가족이 행복한 축제한마당': ['양성평등'],
    '성별영향평가 및 성인지예산 컨설팅 지원': ['양성평등'],
    '세자녀 이상 가족진료비 지원': ['양성평등'],
    '다자녀 가정 농수산물 구입 지원': ['양성평등'],
    '다자녀 가구 이사비 지원': ['양성평등'],
    '문화로 행복한 K-다둥이 프로젝트': ['양성평등'],
    '다자녀 가정 권리장전 제정': ['양성평등'],
    '다둥이 가족 대잔치': ['양성평등'],
    '전통시장 어린이 체험시설 설치': ['양성평등'],
    '찾아가는유아숲프로그램지원': ['양성평등'],
    '에코랜드어린이숲체험전': ['양성평등'],
    '저출생극복세미나및포럼개최등': ['양성평등'],
    '저출생극복우수시군포상': ['양성평등'],
    '저출생극복범도민공감대확산': ['양성평등'],
    '출산장려콘텐츠공모전': ['양성평등'],
    '저출생극복연구용역': ['양성평등'],
    '저출생극복박람회개최등': ['양성평등'],
    '저출생대응정책홍보캠페인': ['양성평등'],
    '저출생정책평가센터운영': ['양성평등'],
    '저출생극복워킹그룹운영등': ['양성평등'],
    '신규공무원『저출생 극복 대응 프로그램』추진': ['양성평등'],
    '자녀돌봄&육아교실_실시간 온라인교육': ['양성평등'],
    '아동친화음식점,「웰컴키즈존」운영': ['양성평등'],
    '유입부터 정주까지 책임, 아시아 이주 허브': ['양성평등']
}



# 제목
st.title("경상북도 돌봄(보듬)사업 공고 설문조사")

st.markdown("""
안녕하세요!👋  **경북도청 AI데이터과** 입니다.

**AI데이터과에서 추진 중인 공공마이데이터 플랫폼 ‘모이소’의 돌봄(보듬) 통합 플랫폼 개발을 위해   
💡 각 부서 여러분의 소중한 협조를 부탁드립니다.**

📋 이 설문은 **경상북도의 각 부서에서 추진 중인 돌봄(보듬) 관련 사업 공고를 체계적으로 수집하기 위한 자료**입니다.  

제출해주신 데이터는 모이소 플랫폼에 게시될 예정으로,  
**최대한 상세하고 구체적인 답변을 주실수록 관련 사업 홍보와 안내에 큰 도움이 됩니다! 🙏**  

📝 **업무로 바쁘시겠지만 5분 정도만 시간 내 주시어 꼼꼼한 답변 작성 부탁드립니다.**   
(최대한 작성시간을 단축시킬 수 있는 방법으로 구성하려고 열심히 노력했답니다:))    
추가 문의 또는 프로그램 이상 발생 시 **AI데이터과 📞2584** 로 언제든지 연락 부탁드립니다 😊 

  
""")


# 카테고리
전체_카테고리 = ['만남주선','행복출산','완전돌봄','안심주거','일생활균형','양성평등']


# 주제
전체_주제 = ['만남.결혼','임신.출산','의료.건강','돌봄','생활','주거','안전','교육','문화관광','기타']


#  고정 footer 생성
footer = st.container()

# 맨 마지막에 footer에 작성
with footer:
    st.markdown(
        """
        <div style='text-align:right; font-size:12px; color:gray;'>
        © 2025 Gyeongbuk AI Data Division <br>
        System designed and developed by Junghyo Kim
        </div>
        """,
        unsafe_allow_html=True
    )


st.markdown("##### 📌 작성자 정보")

# 2개의 컬럼으로 나누기
col1, col2 = st.columns(2)

with col1:
    부서명 = st.text_input("부서명", help="작성자의 부서명을 입력하세요.", placeholder="예: AI데이터과")

with col2:
    연락처 = st.text_input("연락처", help="작성자의 연락처를 입력하세요.", placeholder="예: 054-880-XXXX")


st.markdown("##### 📌 기본 정보")

# 소관부서
기관 = st.selectbox("해당 사업 소관부서를 선택하세요:", 부서_리스트, help="공고를 담당하는 소관 부서를 선택합니다.")

# 사업명 선택
if 사업리스트[기관]:
    사업명_선택 = st.selectbox("공고/사업명을 선택하세요:", 사업리스트[기관] + ['기타 (직접 입력)'])
    if 사업명_선택 == '기타 (직접 입력)':
        사업명 = st.text_input("공고/사업명을 입력해 주세요:")
    else:
        사업명 = 사업명_선택
else:
    사업명 = st.text_input("공고/사업명을 입력해 주세요:")

# 카테고리 복수선택 (자동 추천 포함)
선택카테고리 = st.multiselect(
    "카테고리를 선택하세요:",
    전체_카테고리,
    help="사업의 특성에 맞는 카테고리를 선택하세요(복수선택 가능)."
)

# 주제 복수선택
선택주제 = st.multiselect(
    "주제를 선택하세요:",
    전체_주제,
    help="사업의 주제 분야를 선택하세요(복수선택 가능)."
)

# 가구
#가구 = st.text_input("가구", help="지원대상이 되는 가구 유형을 입력하세요.")
가구옵션 = [
    '다자녀가구', '한부모가구',
    '조손가구', '청년 1인가구',
    '신혼부부', '임신부 가구',
    '영유아 자녀가구', '노인가구',
    '고령자 가구', '다문화가구',
    '장애인가구', '저소득가구',
    '취약계층', '1인가구',
    '기타'
]

가구선택 = st.multiselect(
    "가구 형태를 선택하세요:", 
    가구옵션, 
    help="지원대상이 되는 가구 유형을 선택하세요(복수선택 가능)"
)
if 가구선택 == '기타 (직접 입력)':
    가구직접입력 = st.text_input("연령대 직접 입력", help="자유롭게 연령 범위를 작성하세요.")
    가구최종 = 가구직접입력
else:
    가구최종 = 가구선택
    


# 나이
나이옵션 = ['0~5세', '6~7세', '8~10세', '10세 이하', '미취학 아동', '초등학생', '중학생', '고등학생', '성인', '전체', '기타 (직접 입력)']
나이선택 = st.selectbox("대상 연령대", 나이옵션, help="지원대상자의 연령대 범주를 선택하세요.")
if 나이선택 == '기타 (직접 입력)':
    나이직접입력 = st.text_input("연령대 직접 입력", help="자유롭게 연령 범위를 작성하세요.")
    나이최종 = 나이직접입력
else:
    나이최종 = 나이선택
    


# 정부24 등록 여부 (조건부 종료)

정부24등록 = st.radio("정부24에 등록되어 있습니까? 정부24에 이미 등록된 사업은 '예' 선택 -> 자료입력 진행하지 않고 즉시제출 가능합니다.",
                  ['예', '아니오'],
                  index=1,  # 👉 두 번째 항목인 '아니오'를 기본 선택
                  help="정부24 사이트에 이미 등록되어 있는 사업인지 선택합니다. 이미 등록되어있다면 바로 제출가능합니다!")



# ✅ 조건부 종료: 예 선택시 바로 제출
if 정부24등록 == '예':
    if st.button("제출하기 (정부24 등록사업)"):
        data = {
            '응답일시': datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
            '응답자부서': 부서명,
            '응답자연락처': 연락처,
            '기관': 기관,
            '사업명': 사업명,
            '카테고리': ', '.join(선택카테고리),
            '주제': ', '.join(선택주제),
            '가구': ', '.join(가구최종),
            '나이': 나이최종,
            '정부24등록': 정부24등록,
            '접수기관명': '',
            '지원대상': '',
            '지원내용': '',
            '신청방법': '',
            '문의처': '',
            '온라인URL': ''
        }

        save_data(data)  # 👉 SQLite + CSV 병행 저장
        st.success("정부24 등록사업으로 바로 제출되었습니다. 감사합니다!")
    st.stop()


st.markdown("##### 📝 상세 정보")


# 나머지 일반 질문 시작


접수기관명 = st.text_input("접수기관명", help="공고를 담당하는 접수기관명을 입력하세요.", placeholder="예: 주민센터,보건소,교육청,경찰서,시·군·구청,기타(경상북도경제진흥원) 등")

#서비스명 = st.text_input("지원형태", help="지원 형태를 작성하세요.(예:현금, 현물, 서비스(일자리) ...")

지원대상 = st.text_area("지원대상", help="지원 서비스에 해당하는 구체적인 대상을 작성하세요.", placeholder="예: 최저생계비 180% 이하 취약·위기가족, 긴급위기가족 등")

지원내용 = st.text_area("지원내용", help="지원하는 내용을 상세히 작성하세요.", placeholder="예: 부모교육서비스 -부모 성장, 부모 자녀 관계 형성, 영양 및 건강관리, 학교, 가정생활지도")

신청방법 = st.text_area("신청방법", height=150, help="사업 신청방법을 자세히 작성해 주세요.", placeholder="* 방문, 온라인, 유선, 기타  * 방문 신청 : 임산부 주민등록지 읍·면·동 주민센터(신분증 지참)  * 온라인 신청 : 정부24(www.gov.kr) 접속(공동인증서 본인인증) 등")
                                        
문의처 = st.text_input("문의처", help="사업접수 및 담당 부서 연락처, 담당자를 입력하세요.", placeholder="예: 부서명/054-000-0000")
온라인URL = st.text_input("온라인 사이트 URL", help="온라인 신청 및 사업상세 안내 URL이 있다면 입력하세요.", placeholder="예: www.gb.go.kr")


# 전체 제출 버튼
if st.button("최종 제출하기"):
    data = {
        '응답일시': datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
        '응답자부서': 부서명,
        '응답자연락처': 연락처,
        '기관': 기관,
        '사업명': 사업명,
        '카테고리': ', '.join(선택카테고리),
        '주제': ', '.join(선택주제),
        '가구': ', '.join(가구최종),
        '나이': 나이최종,
        '정부24등록': 정부24등록,
        '접수기관명': 접수기관명,
        '지원대상': 지원대상,
        '지원내용': 지원내용,
        '신청방법': 신청방법,
        '문의처': 문의처,
        '온라인URL': 온라인URL
    }

    if check_duplicate(data):
        st.warning("⚠ 동일한 내용이 이미 제출된 자료입니다.")
    else:
        save_data(data)
        st.success("설문이 정상적으로 저장되었습니다. 감사합니다!")

#
# 관리자 메뉴
with st.expander("📊 [관리자 전용] 수집된 데이터 관리"):
    admin_password = st.text_input("관리자 비밀번호 입력", type="password", key="관리비번")
    if admin_password == "admin1234":
        if os.path.isfile(CSV_PATH):
            df = pd.read_csv(CSV_PATH)
            st.dataframe(df)

            # 데이터 초기화
            if st.button("🧹 전체 데이터 초기화 (주의)", key="초기화"):
                df_empty = pd.DataFrame(columns=df.columns)
                df_empty.to_csv(CSV_PATH, index=False, encoding='utf-8-sig')
                st.success("✅ 모든 데이터가 초기화되었습니다!")

            # 데이터 삭제 기능
            st.markdown("#### 삭제할 행 선택:")
            if len(df) > 0:
                index_to_delete = st.number_input("삭제할 행 번호 (Index)", min_value=0, max_value=len(df)-1, key="삭제인덱스")
                if st.button("삭제 실행", key="삭제실행"):
                    df.drop(index=index_to_delete, inplace=True)
                    df.reset_index(drop=True, inplace=True)
                    df.to_csv(CSV_PATH, index=False, encoding='utf-8-sig')
                    st.success("✅ 선택한 데이터가 삭제되었습니다.")
            else:
                st.warning("삭제할 데이터가 없습니다.")
        else:
            st.warning("아직 수집된 데이터가 없습니다.")
    elif admin_password != "":
        st.warning("비밀번호가 올바르지 않습니다.")



