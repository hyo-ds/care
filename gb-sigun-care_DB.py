import streamlit as st
import pandas as pd
import datetime
import os
import sqlite3

# 📁 파일경로 설정
CSV_PATH = "시군별_공고_설문결과.csv"
DB_PATH = "sigun_data.db"

# ✅ 최초 실행시 DB 및 테이블 자동 생성
def initialize_database():
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute('''
    CREATE TABLE IF NOT EXISTS survey (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        응답일시 TEXT,
        응답자부서 TEXT,
        응답자연락처 TEXT,
        기관 TEXT,
        사업명 TEXT,
        카테고리 TEXT,
        주제 TEXT,
        가구 TEXT,
        나이 TEXT,
        정부24등록 TEXT,
        접수기관명 TEXT,
        지원대상 TEXT,
        지원내용 TEXT,
        신청방법 TEXT,
        문의처 TEXT,
        온라인URL TEXT
    )
    ''')
    conn.commit()
    conn.close()

# ✅ SQLite 저장 함수
def save_to_database(data):
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    c.execute('''
    INSERT INTO survey (응답일시, 응답자부서, 응답자연락처, 기관, 사업명, 카테고리, 주제, 가구, 나이, 정부24등록, 접수기관명, 지원대상, 지원내용, 신청방법, 문의처, 온라인URL)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    ''', (
        data['응답일시'], data['응답자부서'], data['응답자연락처'], data['기관'], data['사업명'], 
        data['카테고리'], data['주제'], data['가구'], data['나이'], data['정부24등록'],
        data['접수기관명'], data['지원대상'], data['지원내용'], data['신청방법'], data['문의처'], data['온라인URL']
    ))
    conn.commit()
    conn.close()

# ✅ CSV 저장 함수
def save_to_csv(data):
    file_exists = os.path.isfile(CSV_PATH)
    df_new = pd.DataFrame([data])
    if file_exists:
        df_existing = pd.read_csv(CSV_PATH)
        df_combined = pd.concat([df_existing, df_new], ignore_index=True)
    else:
        df_combined = df_new
    df_combined.to_csv(CSV_PATH, index=False, encoding='utf-8-sig')

# ✅ SQLite 중복 검사 함수
def check_duplicate(data):
    conn = sqlite3.connect(DB_PATH)
    c = conn.cursor()
    query = '''
    SELECT COUNT(*) FROM survey
    WHERE 기관 = ? AND 사업명 = ? AND 지원대상 = ? AND 지원내용 = ? AND 신청방법 = ?
    '''
    c.execute(query, (
        data['기관'], data['사업명'], data['지원대상'], data['지원내용'], data['신청방법']
    ))
    count = c.fetchone()[0]
    conn.close()
    return count > 0

# ✅ 통합 저장 함수 (CSV + SQLite)
def save_data(data):
    save_to_database(data)
    save_to_csv(data)

# DB 최초 초기화
initialize_database()

# 🎯 실전 설문 시작 ---------------------------------------------------



# 기관 리스트

시군_리스트 = [
    '경산시', '경주시', '고령군', '구미시', '김천시',
    '문경시', '봉화군', '상주시', '성주군', '안동시',
    '영덕군', '영양군', '영주시', '영천시', '예천군', '의성군',
    '울릉군', '울진군', '청도군', '청송군', '칠곡군', '포항시'
]


사업리스트 = {
    '경산시': [
        '경산시 다자녀가정 지원사업',
        '경산시 아이돌봄',
        '출산축하금 및 장려금 지원',
        '둘째아 이상 건강보험료 지원',
        '인구정책가이드북',
        '아기주민등록증',
        '부부등록증',
        '유축기대여',
        '산후조리비 지원',
        '첫돌 기념선물',
        '예비 부모 엽산제 지원',
        '가임기 여성 임신 전 검사',
        '임산부 건강관리 지원',
        '임신육아교실 운영',
        '임산부 우울증 선별 검진',
        '둘째아 이상 임산부 초음파검사비 지원',
        '태아 기형아 검사비 지원',
        '백일해 예방접종 지원사업'
    ],

    '경주시': [
        '청춘동아리 두근두근 설렘의 시작 프로젝트',
        '큰 행복 품은 작은 결혼식 지원 사업',
        '난임부부 시술비 확대 지원',
        '풍진 항원 항체 검사비 지원',
        '임부 산전 초음파 검사비 지원',
        '임부 기형아 검사비 지원',
        '임산부 영양제 및 소모품 구입',
        '임신 축하용품 지원',
        '출산축하금 및 출산장려금 지원',
        '아가튼튼행복맘 프로그램 운영',
        '산후조리비 지원',
        '민간산후조리원 운영 지원',
        '임산부 및 배우자 백일해 예방접종 지원',
        '영유아 영양제 지원(저소득, 다문화,다자녀)',
        'ADHD 특화치료도시 조성',
        '외국인아동 어린이집 보육료 지원(0~2세)',
        '초등학교 입학축하금 지원',
        '중·고 신입생 교복구입비 지원',
        '북스타트 사업',
        '다둥이 가정의 행복한 추억만들기 사진전',
        '어린이 보듬밥상',
        '열린 맘 임신 출산 서비스 지원',
        'K-U시티 청년정주 공동주택 보급',
        '청년 신혼부부 월세 지원',
        '청년 월세 한시 특별 지원',
        '산부인과,소와과 One-hour 진료체계 구축',
        '대학생 아이돌봄 서포터즈 운영',
        '아이돌봄 종사자 처우개선비(수당) 지원',
        '신혼부부 임차보증금 이자지원사업',
        '임산부 친환경 농산물 지원',
        '영구적 불임예상 생식세포 동결보존지원',
        '냉동난자 사용 보조생식술지원',
        '임신사전 건강관리지원',
        '저소득층 기저귀 조제분유 지원',
        '미숙아 및 선천성이상아 의료비 지원',
        '산모,신생아 건강관리지원',
        '출산축하박스 지원',
        '선천성 대사이상 검사 및 환아 관리',
        '35세 이상 산모 의료비 지원',
        '청소년산모 의료비 지원',
        '고위험임산부 의료비 지원',
        '난청조기진단검사지원',
        '세자녀이상 가족 진료비 지원',
        '첫만남이용권',
        '농촌형 보육서비스 지원사업',
        '소상공인 출산장려 아이보듬 지원'
    ],

    '고령군': [
    '다자녀가정 양육장려금 지원',
    '다자녀가정 대학 학자금 지원',
    '세자녀이상 온가족건강지원\n(건강키트제공, 독감예방접종지원 포함)',
    '아이나라 키즈교육센터 운영',
    '고령군 교복 구입비 지원',
    '고령군 결혼예식장 이용 장려금 지원',
    '고령군 청년 월세 주거비 지원사업',
    '고령군 청년 행복 임대주택 운영',
    '임산부, 영유아 영양제 지원',
    '엄마가 살기좋은 도시 진료비 지원',
    '모자보건 프로그램 운영',
    '출산장려금 지원',
    '출생아 건강보험료 지원',
    '아기주민등록증 발급',
    '출산가정 가족사진 지원사업',
    '산모 산후조리비 지원'
   ],

    '구미시': [
    '미혼남녀 커플매칭 프로젝트 「두근두근~ing」',
    '청년근로자 결혼장려금 지원',
    '구미시 청년월세 지원',
    '청년 전월세보증금 대출이자 지원',
    '구미시 난임극복 마음건강지원사업',
    '구미시 기형아검사비 지원',
    '구미시 풍진검사 지원',
    '구미시 임산부 교실',
    '구미+신생아집중치료센터(NICU)운영',
    '산후조리비 지원',
    '출산축하금 지원',
    '구미시육아종합지원센터 운영',
    '외국인 아동 보육료 지원',
    '자녀돌봄품앗이 운영',
    '찾아가는 가족인식개선 교육',
    '중고등학교 신입생 교복 지원비',
    '구미시 다둥e앱 운영',
    '세자녀 이상 다자녀 가정 상수도 요금 지원',
    '다자녀 출생(입양)신고자 종량제봉투 지급',
    '한부모가족 건강검진비'
],

     '김천시': [
    '전입 중·고등·대학생 기숙사비 등 지원',
    '임산부 농산물 꾸러미 지원',
    '신혼부부 및 임산부 건강관리(풍진검사)',
    '임산부 엽산제, 철분제, 영양제 제공',
    '임산부 태아 기형아 검사 지원',
    '임산부교실',
    '정관난관 복원시술비 지원',
    '난자냉동 시술비 지원',
    '김천시 난임부부 시술비 지원',
    '임신축하금 지원',
    '출산장려금지원',
    '산모아기돌봄 지원',
    '산후조리비 지원',
    '출산 육아용품 무료대여',
    '셋째이상 출생아 건강보험금 지원',
    '워킹맘앤대디 힐링캠프(가족친화 힐링캠프)',
    '행복육아사진공모전(사업명 변경)',
    '「사서가 들려주는 그림책 이야기」 유아기 독서프로그램',
    '「토요일엔 책 읽어주세요」 영유아 독서프로그램',
    '맘(MOM)편한 도서택배서비스',
    '「너는 내운명」 태교 · 육아힐링프로그램',
    '출생아 북스타트 책꾸러미 제공',
    '유치원 무상급식 지원',
    '초등틈새 독서교실'
],

    '의성군': [],
    
    '문경시': [
    '셋째아 이상 출생아 건강보험가입 지원',
    '문경시 세자녀 이상 가족진료비 확대 지원 사업',
    '국공립 어린이집 운영지원',
    '민간어린이집 아동 간식비 지원',
    '어린이집 친환경농산물 지원',
    '지역아동센터 아동 간식비 지원',
    '신혼부부 주거비 이자 지원',
    '임신 초기 산전검진',
    '임산부 초음파 쿠폰 발급',
    '임산부 1차 기형아 검사비 지원',
    '임산부 교실 운영',
    '임산부 차량표지 발급',
    '임산부 및 영유아 영양제 지급',
    '출산장려금 지원',
    '문경시 출산축하용품 지급',
    '알뜰 육아용품 대여사업',
    '문경시 산후조리비 지원'
],

     '봉화군': [
    '드림스타트 결식우려아동 반찬지원',
    '가사돌봄지원사업',
    '어린이집급간식비지원',
    '어린이집연합운동회',
    '결혼예식장려금지원',
    '봉화군 임산부 영양보충제 지원',
    '봉화군 출산육아지원금 지급',
    '봉화군 산후조리비 지급',
    '봉화군 태아 출생아 건강보험 지원',
    '청소년 육성프로그램 운영'
],


    '상주시': [
    '결혼장려금 지원',
    '작은결혼식 지원',
    '난임진료 교통비 지원',
    '난자냉동 시술비 지원',
    '산전산후 의료비지원',
    '임산부 엽산제 및 영양제 지원',
    '출산육아지원금 지원',
    '출생아 건강보험금 지원',
    '임신 사전건강관리 지원사업',
    '여성장애인 출산 비용 지원',
    '산모신생아 건강관리지원사업',
    '유치원 급식 지원',
    '돌봄센터 친환경 과일간식 지원사업',
    '다함께돌봄센터 급식비 지원',
    '다함께돌봄센터 연장 운영',
    '다함께돌봄센터 간식비 지원',
    '다문화가족자녀 심리치료 프로그램',
    '가족심리치료 프로그램',
    '육아종합지원센터 연회비 면제',
    '입학준비금',
    '출산축하 해피박스 지원',
    '영유아 건강검진사업',
    '바구니 카시트 대여',
    '출생아 첫만남 이용권',
    '미래교육종합지원플랫폼 구축',
    '세자녀이상 가족진료비 지원',
    '다자녀가구 상하수도 요금 지원',
    '다자녀 가구 거꾸로 옛이야기나라 숲 이용료 감면',
    '다자녀 가구 상주시 수상레저센터 이용료 감면',
    '다자녀 가구 상주 국제승마장 이용료 감면'
],


    '성주군': [
    '작은결혼식',
    '결혼장려금, 관내결혼식',
    '다문화가족초등학생자녀학습도움사업',
    '결혼이민자가정고향방문지원사업',
    '다문화가족국제특송요금지원',
    '성주군 출산양육지원금 지원',
    '성주군 아기보험가입 지원',
    '성주군 산후조리비 지원',
    '성주군 임산부 영양제 지원',
    '성주군 임신초기 풍진검사비 지원',
    '성주군 영유아 영양제 지원',
    '성주군 도담도담놀이터 운영',
    '성주군 출산육아용품대여실 운영',
    '성주군 두자녀 이상 가정 인플루엔자 무료 예방접종',
    '성주군 세자녀 이상 가정 가족사진 지원',
    '성주군 세자녀 이상 태아초음파검사비 지원',
    '성주군 두자녀 이상 가족진료비 감면',
    '초등ART돌봄서비스'
],
 
    '안동시': [
    '출산예비가정 백일해 무료 예방접종',
    '태아기형아 검사 쿠폰 지원',
    '임산부 및 영유아 영양제 지원',
    '표준모자보건수첩 지원',
    '난임부부지원사업',
    '행복한 힐링 출산교실 프로그램 운영',
    '출산육아용품대여사업',
    '출산장려금 및 출산축하금 지급',
    '둘째아 이상 건강보험료 지원사업',
    '임산부 초기 기초검사 및 예비·신혼부부 건강검진',
    '미혼남녀 만남 프로그램',
    '방문건강관리사업',
    '다자녀가정 상수도사용료 감면',
    '출산가정 상수도사용료 감면',
    '경로당 연계 아동돌봄서비스',
    '다문화가족 자녀 학원비 지원',
    '다문화가족 고향방문지원 사업',
    '다문화가족 맞춤형 사례관리 지원',
    '다문화가족 자녀 심리치료지원',
    '다문화가족 자녀 멘토링 사업',
    '다문화가족 출산 지원',
    '중증장애인 돌봄 및 가족휴식지원사업',
    '장애인 틈새돌봄서비스 지원사업',
    '북스타트 책꾸러미 지원사업'
],

'영덕군': [
    '산후조리비 지원',
    '아기등록증 및 탄생축하선물 지원',
    '출산장려금 지급',
    '출생아 건강보험 지원',
    '임신부 초음파 · 기형아 · 풍진검사비 지원',
    '출산육아용품 지원센터 운영',
    '지품팡팡놀이터 운영'
],

    '영양군': [
    '키즈카페 「아이로」 운영',
    '청년부부만들기(결혼장려금)',
    '결혼비용 지원사업',
    '청년 전입자 주택임차료 지원사업',
    '영양군 다문화가족 합동결혼식',
    '출산장려금지원',
    '둘째아 이상 건강보장보험료 지원',
    '영유아 영양제 지원',
    '영양군 태아 기형아 검사비 지원',
    '임산부 영양제 지원'
],

    '영주시': [
    '행복한 첫걸음 아기마중교실',
    '숲태교 프로그램 운영',
    '출생아 출산장려금 등 지원',
    '육아용품 대여실 운영',
    '건강가정 건강출산 지원',
    '산후조리비 지원',
    '아기 주민등록증 발급',
    '유치원 무상급식 지원',
    '유치원 아동급식용 우수식재료 구입비 지원',
    '학교급식 친환경인증쌀 차액지원',
    '홍삼간식 지원',
    '몸으로 예술놀이',
    '찾아가는 가족사랑의 날',
    '농어촌아동놀이시설 운영\n(부석올라올라놀이터)',
    '휴일어린이집 운영',
    '아이! 신나 실내놀이터',
    '전통연희 체험교육',
    '외국인아동(0~2세)보육료 지원',
    '가정위탁아동 교통비 지원',
    '한부모가족자녀 기능교육비 지원',
    '다문화가족 어울림 한마당'
],

    '영천시': [
    '신혼부부 결혼장려금',
    '신혼부부 전세자금 대출이자 지원',
    '아기주민등록증 발급',
    '취약계층 아동 이용료(다함께돌봄센터) 지원',
    '다문화가족자녀학교적응지원',
    '다함께돌봄센터 이용아동 급간식비 지원',
    '영천시 어린이집 식기토탈케어서비스 지원',
    '임산부 아기사랑택시 지원사업',
    '임신전 엽산제 지원',
    '임신부 초음파 · 막달 건강검진비 지원',
    '산후조리비 지원',
    '영유아영양제지원',
    '임산부건강관리지원',
    '출산육아용품대여',
    '다자녀산모보약지원',
    '산모영양제',
    '출산가정 축하용품 지원',
    '출산양육장려금 지원'
],

   '예천군': [
    '출산축하금 지원',
    '출산장려금 지원',
    '임신부 산전 건강검진 지원',
    '임신부 초음파 검사 쿠폰 지원',
    '임신부 기형아 검사 쿠폰 지원',
    '임신부 영양제 지원',
    '출생아 건강보험료 지원',
    '산모 신생아 식품꾸러미 지원',
    '영유아 영양제 지원',
    '예천군 아이누리 장난감 도서관 놀이지도 프로그램',
    '아기주민등록증 무료 발급',
    '청춘남녀 만남 지원 사업',
    '예천군 청소년수련관 사용료 감면',
    '예천군 골프연습장 사용료 감면',
    '예천온천 이용료 감면',
    '예천군 곤충생태원 관람료 및 모노레일 탑승료 감면'
],

'울릉군': [
    '결혼장려금 지원사업',
    '임산부교통비지원사업',
    '출산장려금원사업',
    '드림아이육아용품대여사업',
    '임산부아동건강관리(엽산제 및 철분제 지급)',
    '어린이집운영지원',
    '울릉한마음꿈터운영',
    '청소년센터프로그램운영',
    '전입세대 지원사업',
    '주택에 대한 취득세 감면',
    '자동차 취득세 감면',
    '세대별맞춤형평생교육'
],

'울진군': [
    '예비부부·예비맘 건강관리 지원사업',
    '임산부 지원사업',
    '출산준비교실',
    '출산장려금 지원',
    '출생아 건강보험 지원',
    '출생축하기념품 지원',
    '아이사랑육아용품 대여사업',
    '임산부 친환경농산물 지원사업',
    '경로당 공동취사제 운영',
    '저소득 재가노인 식사배달',
    '저소득 재가노인 명절위문',
    '노인요양시설 입소자 위문',
    '보육아동 친환경농산물 지원'
],

'청도군': [
    '여성회관 보육실 운영',
    '임신부 태아 기형아 검사 지원',
    '탄생축하 기념패 제작 지원',
    '신혼(예비)부부 건강검진사업',
    '임신부 및 남편 백일해 예방접종지원사업',
    '출산지원금 지원사업',
    '나만의 우표 지원',
    '임산부 및 영유아 영양제 지급',
    '아가랑 첫만남 첫도장 제작 지원',
    '아기주민등록증 발급',
    '임신 축하용품 지원',
    '산후조리비 지원',
    '출산축하박스지원',
    '신생아 및 입양영아 건강보험료 지원사업',
    '작고 강한학교 만들기 프로젝트(행복울타리 프로젝트)',
    '지역특화 어린이집 육성 (행복울타리 프로젝트)',
    '마을 돌봄공동체 육성 (행복울타리 프로젝트)',
    '신혼부부 주거자금 대출이자 지원사업',
    '다자녀가구 상하수도 요금 감면',
    '출산농가 영농도우미지원사업',
    '농촌가정출생육아멘토링(저출생)',
    '다자녀가구 농수산물 구입 지원 사업',
    '결혼축하 혼수비용 지원사업'
],

'청송군': [
    '결혼이민여성 정착지원금 및 자녀양육수당 지원사업',
    '작은 결혼식장 대여',
    '임산부 영유아 건강지원',
    '임신출산준비교실',
    '임신진단 및 기형아검사',
    '출산축하금 및 출산장려금',
    '출생아 건강보험료지원',
    '임신 및 출산축하선물(행복맘꾸러미)',
    '돌사진 촬영비 지원',
    '어린이집영유아급간식비지원',
    '어린이집교재교구비지원'
],

'칠곡군': [
    '늘봄인 작은도서관 지원사업',
    '칠곡군 북스타트 지원',
    '예비부모건강검진 및 엽산제 지원',
    '칠곡군 임산부 건강관리 서비스',
    '칠곡군 임신부 영양제 지원',
    '칠곡군 태아 기형아 검사비 지원',
    '칠곡군 임부교실 운영',
    '칠곡군 출산장려금 지원',
    '산후조리비 지원',
    '칠곡군 출산·육아용품 무료 대여실 운영',
    '칠곡행복플러스카드',
    '중고등학교 신입생 교복 구입비 지원',
    '다자녀 수도요금 감면'
],

'포항시': [
    '신혼부부 임차보증금 이자지원',
    '국가필수예방접종 지원(19종)',
    '소아응급의료기관 운영지원',
    '의료급여 수급권자 건강검진 홍보비',
    '여성인력개발센터 운영',
    '여성새로일하기센터 운영',
    '여성시간선택제 일자리사업(엄마참손단&아이행복도우미)',
    '작은결혼식 문화 조성',
    '가족행복센터 운영',
    '미혼남녀 커플 매칭',
    '35세이상 산모 의료비 지원',
    '고위험 임산부 의료비 지원',
    '난임부부 시술비 지원',
    '난임부부 시술비 확대 지원',
    '신생아 난청검사 및 보청기 지원',
    '냉동난자 사용 보조 생식술 지원',
    '미숙아 및 선천성 이상아 의료비 지원',
    '산모?신생아 건강관리 지원사업',
    '산모?신생아 건강관리 본인부담금 지원',
    '생애초기 건강관리사업 운영비',
    '선천성 대사이상 검사 및 환아 의료비 지원',
    '아토피?천식 환자 의료비 지원',
    '영구적 불임예상 생식세포 동결보존 지원',
    '영양플러스 식품 지원',
    '임신 사전 건강관리 지원',
    '저소득층 기저귀 조제분유 지원',
    '청소년 산모 임신 출산 의료비 지원',
    '출산 축하박스 지원',
    '태아 기형아?풍진항체 검사비 지원',
    '임산부 엽산제 및 철분제 지원',
    '맘편한 임신 원스톱 서비스',
    '유축기 대여',
    '출산힐링센터 운영',
    '영유아건강검진 지원',
    '영유아 발달장애 정밀검사비 지원',
    '임신 축하 선물(임신 등록용품 지원)',
    '임산부 친환경농산물 지원',
    '임산부 도서대출 택배서비스',
    '초보 엄마아빠 북돋움 책선물 사업',
    '출산돌봄 토크 콘서트',
    '첫만남 이용권 지원',
    '출산장려금 지급',
    '둘째아 이상 출생아 건강보험 가입 지원',
    '육아용품 지원센터 운영',
    '부모급여(만0~1세/영아수당) 지급',
    '아동수당 지급',
    '입양아 가정 양육비 지원',
    '장애 입양아 가정 양육비 지원',
    '다함께돌봄(마을돌봄터) 지원',
    '출산농가 영농도우미 지원',
    '찾아가는 돌봄교실 지원',
    '농번기 돌봄 지원',
    '농어촌지역 사랑의 공부방 운영 지원',
    '직장맘&아픈아이 SOS서비스 운영 지원',
    '영유아 보육료 지원',
    '만3~5세 부모부담보육료 지원',
    '가정양육수당',
    '야간연장 보육지원',
    '아이돌봄서비스 지원',
    '아이누리 키즈카페 운영',
    '아이누리 장난감 도서관 운영',
    '국공립 어린이집 확충을 통한 보육 공공성 확대',
    '시간제 긴급보육 서비스 운영 지원',
    '24시간(365돌봄) 어린이집 운영',
    '다자녀가정 국민여가캠핑장 이용료 감면',
    '다자녀 공영주차장 주차요금 감면',
    '다자녀가정 시립예술단 공연 입장료 및 관람료 할인',
    '세자녀 이상 가족 진료비 지원',
    '다자녀가족 상?하수도 요금 감면',
    '다자녀가정 특별양육지원금 지급',
    '다자녀가정 종량제 봉투 무상 지원',
    '다자녀가정 평생교육 우선 접수&수강료 면제',
    '중고등학교 신입생 교복비 지원',
    '진로진학지원센터 운영',
    '대학진학 박람회',
    '대학 상담 캠프 운영',
    '초중고 무상급식 지원',
    '친환경농산물 학교 급식 지원',
    '유치원 급식 지원',
    '친환경농산물 유치원 급식 지원',
    '학교 우유급식 지원'
]
}



for 기관 in 시군_리스트:
    if 기관 not in 사업리스트:
        사업리스트[기관] = []


# 카테고리
전체_카테고리 = ['만남주선','행복출산','완전돌봄','안심주거','일생활균형','양성평등']


# 주제
전체_주제 = ['만남.결혼','임신.출산','의료.건강','돌봄','생활','주거','안전','교육','문화관광','기타']

# 제목
st.title("경상북도 시군별 돌봄(보듬)사업 공고 설문조사")

st.markdown("""
안녕하세요!👋  **경북도청 AI데이터과** 입니다.

**경북도청에서 추진 중인 공공마이데이터 플랫폼 ‘모이소’의 돌봄(보듬) 통합 플랫폼 개발을 위해   
💡 시군 사업 담당자 여러분의 소중한 협조를 부탁드립니다.**

📋 이 설문은 **각 시군에서 추진 중인 돌봄(보듬) 관련 사업 공고를 체계적으로 수집하기 위한 자료**입니다.  

제출해주신 데이터는 모이소 플랫폼에 게시될 내용이므로,  
**최대한 상세하고 구체적인 답변을 주실수록 관련 사업 홍보와 안내에 큰 도움이 됩니다! 🙏**  

업무로 바쁘시겠지만 5분 정도만 시간 내 주시어 꼼꼼한 답변 작성 부탁드리며,📝    
추가 문의 또는 설문 진행중 이상 발생 시 **경북도청 AI데이터과 📞054-880-2584** 로 언제든지 연락 부탁드립니다 😊 
  
""")

#  고정 footer 생성
footer = st.container()

# 맨 마지막에 footer에 작성
with footer:
    st.markdown(
        """
        <div style='text-align:right; font-size:12px; color:gray;'>
        © 2025 Gyeongbuk AI Data Division <br>
        System designed and developed by Junghyo Kim
        </div>
        """,
        unsafe_allow_html=True
    )
    
st.markdown("##### 📌 작성자 정보")

# 2개의 컬럼으로 나누기
col1, col2 = st.columns(2)

with col1:
    부서명 = st.text_input("부서명", help="작성자의 부서명을 입력하세요.", placeholder="예: AI데이터과")

with col2:
    연락처 = st.text_input("연락처", help="작성자의 연락처를 입력하세요.", placeholder="예: 054-880-XXXX")


st.markdown("##### 📌 기본 정보")

# 소관부서
기관 = st.selectbox("소관부서를 선택하세요:", 시군_리스트, help="공고를 담당하는 소관 부서를 선택합니다.")

# 사업명 선택
if 사업리스트[기관]:
    사업명_선택 = st.selectbox("공고/사업명을 선택하세요:", 사업리스트[기관] + ['기타 (직접 입력)'])
    if 사업명_선택 == '기타 (직접 입력)':
        사업명 = st.text_input("공고/사업명을 입력해 주세요:")
    else:
        사업명 = 사업명_선택
else:
    사업명 = st.text_input("공고/사업명을 입력해 주세요:")

# 카테고리 복수선택 (자동 추천 포함)
선택카테고리 = st.multiselect(
    "카테고리를 선택하세요:",
    전체_카테고리,
    help="사업의 특성에 맞는 카테고리를 선택하세요(복수선택 가능)."
)

# 주제 복수선택
선택주제 = st.multiselect(
    "주제를 선택하세요:",
    전체_주제,
    help="사업의 주제 분야를 선택하세요(복수선택 가능)."
)

# 가구
#가구 = st.text_input("가구", help="지원대상이 되는 가구 유형을 입력하세요.")
가구옵션 = [
    '다자녀가구', '한부모가구',
    '조손가구', '청년 1인가구',
    '신혼부부', '임신부 가구',
    '영유아 자녀가구', '노인가구',
    '고령자 가구', '다문화가구',
    '장애인가구', '저소득가구',
    '취약계층', '1인가구',
    '기타'
]

가구선택 = st.multiselect(
    "가구 형태를 선택하세요:", 
    가구옵션, 
    help="지원대상이 되는 가구 유형을 선택하세요(복수선택 가능)"
)
if 가구선택 == '기타 (직접 입력)':
    가구직접입력 = st.text_input("연령대 직접 입력", help="자유롭게 연령 범위를 작성하세요.")
    가구최종 = 가구직접입력
else:
    가구최종 = 가구선택

# 나이
나이옵션 = ['0~5세', '6~7세', '8~10세', '10세 이하', '미취학 아동', '초등학생', '중학생', '고등학생', '성인', '전체', '기타 (직접 입력)']
나이선택 = st.selectbox("대상 연령대", 나이옵션, help="지원대상자의 연령대 범주를 선택하세요.")
if 나이선택 == '기타 (직접 입력)':
    나이직접입력 = st.text_input("연령대 직접 입력", help="자유롭게 연령 범위를 작성하세요.")
    나이최종 = 나이직접입력
else:
    나이최종 = 나이선택
    

# 정부24 등록 여부 (조건부 종료)

정부24등록 = st.radio("정부24에 등록되어 있습니까? 정부24에 이미 등록된 사업은 '예' 선택 -> 자료입력 진행하지 않고 즉시제출 가능합니다.",
                  ['예', '아니오'],
                  index=1,  # 👉 두 번째 항목인 '아니오'를 기본 선택
                  help="정부24 사이트에 이미 등록되어 있는 사업인지 선택합니다. 이미 등록되어있다면 바로 제출가능합니다!")


# ✅ 조건부 종료: 예 선택시 바로 제출
if 정부24등록 == '예':
    if st.button("제출하기 (정부24 등록사업)"):
        data = {
            '응답일시': datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
            '응답자부서': 부서명,
            '응답자연락처': 연락처,
            '기관': 기관,
            '사업명': 사업명,
            '카테고리': ', '.join(선택카테고리),
            '주제': ', '.join(선택주제),
            '가구': ', '.join(가구최종),
            '나이': 나이최종,
            '정부24등록': 정부24등록,
            '접수기관명': '',
            '지원대상': '',
            '지원내용': '',
            '신청방법': '',
            '문의처': '',
            '온라인URL': ''
        }

        save_data(data)  # 👉 SQLite + CSV 병행 저장
        st.success("정부24 등록사업으로 바로 제출되었습니다. 감사합니다!")
    st.stop()


st.markdown("##### 📝 상세 정보")


# 나머지 일반 질문 시작

접수기관명 = st.text_input("접수기관명", help="공고를 담당하는 접수기관명을 입력하세요.", placeholder="예: 주민센터,보건소,교육청,경찰서,시·군·구청,기타(경상북도경제진흥원) 등")

#서비스명 = st.text_input("지원형태", help="지원 형태를 작성하세요.(예:현금, 현물, 서비스(일자리) ...")

지원대상 = st.text_area("지원대상", help="지원 서비스에 해당하는 구체적인 대상을 작성하세요.", placeholder="예: 최저생계비 180% 이하 취약·위기가족, 긴급위기가족 등")

지원내용 = st.text_area("지원내용", help="지원하는 내용을 상세히 작성하세요.", placeholder="예: 부모교육서비스 -부모 성장, 부모 자녀 관계 형성, 영양 및 건강관리, 학교, 가정생활지도")

신청방법 = st.text_area("신청방법", height=150, help="사업 신청방법을 자세히 작성해 주세요.", placeholder="* 방문, 온라인, 유선, 기타  * 방문 신청 : 임산부 주민등록지 읍·면·동 주민센터(신분증 지참)  * 온라인 신청 : 정부24(www.gov.kr) 접속(공동인증서 본인인증) 등")
                                        
문의처 = st.text_input("문의처", help="담당 부서 연락처, 담당자 등을 입력하세요.", placeholder="예: 부서명/054-000-0000")
온라인URL = st.text_input("온라인 사이트 URL", help="온라인 신청 및 사업상세 안내 URL이 있다면 입력하세요.")

# 전체 제출 버튼
if st.button("최종 제출하기"):
    data = {
        '응답일시': datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
        '응답자부서': 부서명,
        '응답자연락처': 연락처,
        '기관': 기관,
        '사업명': 사업명,
        '카테고리': ', '.join(선택카테고리),
        '주제': ', '.join(선택주제),
        '가구': ', '.join(가구최종),
        '나이': 나이최종,
        '정부24등록': 정부24등록,
        '접수기관명': 접수기관명,
        '지원대상': 지원대상,
        '지원내용': 지원내용,
        '신청방법': 신청방법,
        '문의처': 문의처,
        '온라인URL': 온라인URL
    }

    if check_duplicate(data):
        st.warning("⚠ 동일한 내용이 이미 제출된 자료입니다.")
    else:
        save_data(data)
        st.success("설문이 정상적으로 저장되었습니다. 감사합니다!")

#
# 관리자 메뉴
with st.expander("📊 [관리자 전용] 수집된 데이터 관리"):
    admin_password = st.text_input("관리자 비밀번호 입력", type="password", key="관리비번")
    if admin_password == "admin1234":
        if os.path.isfile(CSV_PATH):
            df = pd.read_csv(CSV_PATH)
            st.dataframe(df)

            # 데이터 초기화
            if st.button("🧹 전체 데이터 초기화 (주의)", key="초기화"):
                df_empty = pd.DataFrame(columns=df.columns)
                df_empty.to_csv(CSV_PATH, index=False, encoding='utf-8-sig')
                st.success("✅ 모든 데이터가 초기화되었습니다!")

            # 데이터 삭제 기능
            st.markdown("#### 삭제할 행 선택:")
            if len(df) > 0:
                index_to_delete = st.number_input("삭제할 행 번호 (Index)", min_value=0, max_value=len(df)-1, key="삭제인덱스")
                if st.button("삭제 실행", key="삭제실행"):
                    df.drop(index=index_to_delete, inplace=True)
                    df.reset_index(drop=True, inplace=True)
                    df.to_csv(CSV_PATH, index=False, encoding='utf-8-sig')
                    st.success("✅ 선택한 데이터가 삭제되었습니다.")
            else:
                st.warning("삭제할 데이터가 없습니다.")
        else:
            st.warning("아직 수집된 데이터가 없습니다.")
    elif admin_password != "":
        st.warning("비밀번호가 올바르지 않습니다.")




