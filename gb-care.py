import streamlit as st
import pandas as pd
import datetime
import os

save_path = "기관별_공고_설문결과.csv"  


# 기관 리스트
부서_리스트 = [
    'AI데이터과',
    '저출생대응정책과',
    '공공의료과',
    '구조구급과',
    '교통정책과',
    '해양레저관광과',
    '보건정책과',
    '스마트농업혁신과',
    '경북도서관',
    '관광마케팅과',
    '외국인공동체과',
    '아이돌봄과',
    '자치경찰정책과',
    '재난대응과',
    '새마을봉사과',
    '농식품유통과',
    '예방안전과',
    '문화예술과',
    '교육청소년과',
    '119종합상황실',
    '농업대전환과',
    '농업테크노파크과',
    '청년정책과',
    '건축디자인과',
    '지역개발과',
    '도시계획과',
    '공항추진과',
    '수자원관리과',
    '여성가족과',
    '경제정책노동과',
    '축산정책과',
    '민생경제과',
    '기업지원과',
    '문화산업과',
    '지방시대정책과',
    '인재개발원 교육운영과'
]


사업리스트 = {
    'AI데이터과': [
        '돌봄 통합정보 제공 서비스',
        '제조업 A융합 기반 조성사업'
    ],
    '저출생대응정책과': [
        '결혼 축하 혼수 비용 지원',
        '청춘남녀 만남주선 사업 지원',
        '(남성) 난임부부 시술비 지원',
        '한의약 난임치료지원',
        '영구적불임예상생식세포동결보존지원',
        '냉동난자 사용 보조생식술 지원',
        '임신사전 건강관리지원',
        '안동의료원난임센터운영지원',
        '난임·우울증 상담센터 운영지원',
        '35세이상산모의료비지원',
        '청소년산모의료비지원',
        '고위험임산부의료비지원',
        '거점형 공공산후조리원 설치지원',
        '공공산후조리원 확대',
        '공공산후조리원 운영지원',
        '경북형 신생아 집중치료센터 운영 지원',
        '산모 신생아 건강관리지원',
        '생애초기 건강관리 지원',
        '출산축하박스지원',
        '미숙아 및 선천성 이상아 의료비 지원',
        '선천성 대사이상 검사 및 환아 관리',
        '난청조기진단',
        '저소득층 기저귀 조제분유 지원',
        '출산 및 보육 관련 프로그램 지원',
        '첫만남이용권 지원',
        '융합 돌봄 특구 조성',
        '산단 특화 돌봄‧교육 통합센터 건립',
        '다자녀 가정 큰 집 마련 지원',
        '세자녀 이상 가족진료비 지원',
        '다자녀 가정 농수산물 구입 지원',
        '다자녀 가구 이사비 지원',
        '지자체선도 저출생 대응 인식개선 사업(100인의 아빠단)',
        '인구의날기념행사',
        '아이사랑가족대축제',
        '다자녀 가정 권리장전 제정',
        '다둥이 가족 대잔치',
        '저출생극복세미나및포럼개최등',
        '저출생극복우수시군포상',
        '저출생극복범도민공감대확산',
        '출산장려콘텐츠공모전',
        '저출생극복연구용역',
        '저출생극복박람회개최등',
        '저출생대응정책홍보캠페인',
        '저출생정책평가센터운영',
        '저출생극복워킹그룹운영등'
    ],
    '공공의료과': [
        '산부인과‧소아과 One-hour 진료체계 구축(민간)',
        '산부인과소아과 One-hour 진료체계구축(자치단체)',
        '김천의료원 분만산부인과 운영'
    ],
    '구조구급과': [
        '새생명탄생119구급서비스'
    ],
    '교통정책과': [
        '임산부 전용 콜택시 운영 지원',
        '온종일 자녀안심 아이사랑 차량 운행'
    ],
    '해양레저관광과': [
        '임신부 어촌마을 태교여행 지원',
        '청년 유입을 위한 빈집 활용 어촌재생 프로젝트'
    ],
    '보건정책과': [
        '순회진료산부인과운영',
        '찾아가는산부인과운영',
        '찾아가는산부인과진료버스구입',
        '분만취약지산부인과운영',
        '분만취약지외래산부인과운영',
        '어린이 식생활영양안전관리 지원',
        '늘봄학교 급‧간식 업체 정보 제공',
        '함께 키워요! 「K보듬 6000」급‧간식 업체 정보지원'
    ],
    '스마트농업혁신과': [
        '임산부 친환경 농산물 지원'
    ],
    '경북도서관': [
        '초보 엄마아빠 북돋움 책선물 사업',
        '돌봄‧독서 융합「경상북도 돌봄도서관」운영',
        '함께 키우는 작은도서관 돌봄사업'
    ],
    '관광마케팅과': [
        '예비 엄마아빠를 위한 행복가족여행',
        '가족이 행복한 축제한마당'
    ],
    '외국인공동체과': [
        '열린 맘 임신 출산 서비스 지원',
        '다문화가족자녀학습및진로지원',
        '다문화가족자녀이중언어대회',
        '다문화인재세계화추진',
        '다문화가족자녀글로벌인재육성지원',
        '외국인 영유아 자녀 보육료 지원',
        '결혼이민여성일자리창출사업',
        '유입부터 정주까지 책임, 아시아 이주 허브'
    ],
    '아이돌봄과': [
        '부모급여',
        '가정양육수당 지원',
        'K보듬지원센터운영',
        '어린이 보듬밥상',
        '찾아가는 놀이 돌봄',
        '장난감도서관 설치 및 운영',
        '영유아창의센터운영',
        '조부모 손자녀 돌봄사업',
        '아이돌봄지원사업 광역지원센터운영지원',
        '영아전담아이돌보미지원',
        '아이돌봄 종사자 처우개선비(수당) 지원',
        '틈새 돌봄을 위한「대학생 아이돌봄 서포터즈」운영',
        '아이돌봄 지원',
        '아이돌봄 부모부담금 경감',
        '함께 키워요! 「K보듬 6000」프로젝트',
        '아픈아이 긴급 돌봄센터 운영',
        '24시 시간제 보육 지원',
        '마을돌봄터(다함께돌봄센터) 설치‧운영',
        '공동육아나눔터운영',
        '도‧시군 육아종합지원센터 운영',
        '공공형 어린이집 지원',
        '아빠와 함께하는 아이행복 캠페인',
        '영유아 대축제'
    ],
    '자치경찰정책과': [
        '함께 키워요! 「K보듬 6000」이동․안전 지원(자치경찰)',
        '늘봄학교 등하교 안전인력 지원(자치경찰)'
    ],
    '재난대응과': [
        '함께 키워요! 「K보듬 6000」이동․안전 지원(소방본부)'
    ],
    '새마을봉사과': [
        '함께 키워요! 「K보듬 6000」자원봉사 프로그램',
        '함께 키워요! 「K보듬 6000」자원봉사 스케일업',
        '늘봄학교 자원봉사자 지원'
    ],
    '농식품유통과': [
        '함께 키워요! 「K보듬 6000」친환경 과일간식 지원'
    ],
    '예방안전과': [
        '119아이행복 돌봄터 운영'
    ],
    '문화예술과': [
        '종교시설을 활용한 돌봄공동체 지원',
        '문화로 행복한 K-다둥이 프로젝트',
        '전통시장 어린이 체험시설 설치'
    ],
    '교육청소년과': [
        '아동수당',
        '늘봄학교 지원',
        '늘봄학교 분야별 전문가 현황 제공',
        '제21회 대한민국 청소년 박람회 개최',
        '청소년 지원 정책',
        '도 청소년 활동진흥센터 지원',
        '시군 청소년 수련시설 확충',
        '청소년 정책참여 및 권익증진',
        '청소년 제안정책 실현사업',
        '도 청소년수련원 기능보강',
        '아동친화도시 조성 지원사업'
    ],
    
    '119종합상황실': [
        '늘봄학교 안전 지원(소방본부)'
    ],
    '농업대전환과': [
        '농촌형 보육서비스 지원사업',
        '농어촌지역 사랑의 공부방 운영 지원',
        '여성농업인 복지시설 운영 지원',
        '출산농가영농도우미 지원'
    ],
    '농업테크노파크과': [
        '농촌가정 출생육아 멘토링'
    ],
    '청년정책과': [
        '청년 월세 한시 특별 지원',
        '청년부부 주거환경 개선'
    ],
    '건축디자인과': [
        '청년 신혼부부 월세 지원',
        '신혼부부 임차보증금 이자지원사업',
        '양육친화형 공공임대주택 공급 추진',
        '지역밀착형 공공임대주택 공급 확대'
    ],
    '지역개발과': [
        '청년 유입을 위한 지역활력타운 조성',
        '도시재생을 통한 공공임대주택 확대'
    ],
    '도시계획과': [
        '도시개발사업구역과 연계한 양육‧친화공간 조성',
        '개발제한구역 활용 주거안정성 확보'
    ],
    '공항추진과': [
        '공항신도시 아이사랑 리빙파크 조성'
    ],
    '수자원관리과': [
        '청년을 위한 하천부지활용 택지공급'
    ],
    '여성가족과': [
        '일‧생활 균형 지원센터 운영',
        '경북 여성일자리 취창업 매칭데이',
        '돌봄연계 경상북도 일자리 편의점 구축',
        '초등맘 10시 출근제 도입 중소기업 장려금 지원',
        '경북형 여성친화도시 조성사업',
        '양성평등정책지원사업',
        '여성리더양성 및 네트워크 사업',
        '우리동네 아빠 교실 운영',
        '청소년부모 양육 등 통합 패키지 지원'
    ],
    '경제정책노동과': [
        '육아휴직 대체인력 근로자 인센티브 지원',
        '육아기 부모 단축 근로시간 급여 보전 지원'
    ],
    '축산정책과': [
        '다자녀축산농가헬퍼(도우미)지원'
    ],
    '민생경제과': [
        '소상공인 출산장려 「아이보듬」지원',
        '전통시장 어린이 체험시설 설치'
    ],
    '기업지원과': [
        '「육아기 근로 시간 단축제도 시행」중소기업 우대'
    ],
    '문화산업과': [
        '문화를 통한 민관협력형 저출생 극복 프로젝트'
    ],
    '지방시대정책과': [
        'K-U시티 청년정주 공동주택 보급'
    ],
    '인재개발원 교육운영과': [
        '신규공무원『저출생 극복 대응 프로그램』추진',
        '자녀돌봄&육아교실_실시간 온라인교육'
    ]
}

for 기관 in 부서_리스트:
    if 기관 not in 사업리스트:
        사업리스트[기관] = []

# 제목
st.title("경상북도 돌봄(보듬)사업 공고 수집 설문조사")

# 1단계: 기관 선택
기관 = st.selectbox("소관부서명을 선택하세요:", 부서_리스트)

# 2단계: 사업명 선택 or 입력
if 사업리스트[기관]:
    사업명_선택 = st.selectbox("공고/사업명을 선택하세요:", 사업리스트[기관] + ['직접 입력'])
    if 사업명_선택 == '직접 입력':
        사업명 = st.text_input("공고/사업명을 입력해 주세요:")
    else:
        사업명 = 사업명_선택
else:
    사업명 = st.text_input("공고/사업명을 입력해 주세요:")

# 3단계: 일반 정보 입력
정부24등록 = st.radio("정부24에 등록되어 있습니까?", ['예', '아니오'])
가구 = st.text_input("가구")
나이 = st.number_input("나이", min_value=0, max_value=120, step=1)
접수기관명 = st.text_input("접수기관명")
서비스명 = st.text_input("서비스명")
지원대상 = st.text_area("지원대상")
지원내용 = st.text_area("지원내용")
문의처 = st.text_input("문의처")
온라인URL = st.text_input("온라인 신청 사이트 URL")

# 제출 버튼
if st.button("제출하기"):
    response = {
        '응답일시': datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
        '기관': 기관,
        '사업명': 사업명,
        '정부24등록': 정부24등록,
        '가구': 가구,
        '나이': 나이,
        '접수기관명': 접수기관명,
        '서비스명': 서비스명,
        '지원대상': 지원대상,
        '지원내용': 지원내용,
        '문의처': 문의처,
        '온라인URL': 온라인URL
    }

    save_path = "기관별_공고_설문결과.csv"
    file_exists = os.path.isfile(save_path)
    df_new = pd.DataFrame([response])

    if file_exists:
        df_existing = pd.read_csv(save_path)
        df_combined = pd.concat([df_existing, df_new], ignore_index=True)
    else:
        df_combined = df_new

    df_combined.to_csv(save_path, index=False, encoding='utf-8-sig')

    st.success("설문이 정상적으로 제출되었습니다. 감사합니다!")

# 관리자 확인용 데이터 출력
with st.expander("📊 수집된 데이터 보기"):
    if os.path.isfile(save_path):
        df = pd.read_csv(save_path)
        st.dataframe(df)
        st.download_button("CSV 다운로드", data=df.to_csv(index=False, encoding='utf-8-sig'),
                           file_name='기관별_공고_설문결과.csv', mime='text/csv')
    else:
        st.write("아직 수집된 데이터가 없습니다.")
